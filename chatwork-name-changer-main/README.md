# Chatwork Name Changer v2

Chatworkの表示名を一時的に変更し、指定時間後に自動で元の名前に戻すためのGoogle Chrome拡張機能です。
このバージョンでは、Chatworkの内部APIを呼び出すことで、ページを閉じている間も変更を維持し、サーバー側で名前を更新します。

## 主要な追加・変更機能
- **名前変更の永続化**: API呼び出しにより、ブラウザを閉じても名前を維持。
- **入力内容の自動保存**: ランチの文言や有給の期限など、一度入力した内容は次回起動時にも引き継がれます。
- **URL事前設定**: 操作ミスを防ぐため、あらかじめマイチャット等のURLを登録して使用します。
- **自動復帰タイマー**: 指定した時間（分単位）や日時（カレンダー指定）で自動的に元の名前に戻ります。

## ファイル構成
- `manifest.json`: 拡張機能の設定（権限、バックグラウンド、スクリプトの設定）。
- `popup.html/js/css`: 操作画面のUIとロジック。
- `content.js`: Chatwork内でのAPI呼び出し・通信。
- `background.js`: タイマー（chrome.alarms）の管理、ブラウザ終了後の復帰処理。
- `page-script.js`: Chatwork内部変数の取得用。

## インストール方法
1. Chrome拡張機能管理ページ (`chrome://extensions/`) を開く。
2. 「デベロッパーモード」を有効化。
3. 「パッケージ化されていない拡張機能を読み込む」をクリック。
4. このプロジェクトフォルダを選択。

## 使い方
1. **Chatwork URLの登録**: 
   - 初回起動時に、Chatworkのマイチャット等のURLを入力して保存してください。
2. **モードの選択**:
   - **ランチモード**: 文言（例: 🍴ランチ中）と復帰時間（分）を入力して開始。
   - **有給/休暇モード**: 文言（例: 🌴有給）と復帰日時を指定して開始。
3. **自動復帰**: 
   - 設定した時間になると、自動的に元の名前に戻ります。
   - 「今すぐ戻す」または「すべての設定を解除」ボタンから手動で戻すことも可能です。

---

## 🛠 動かなくなった場合（メンテナンス機能）
もし名前が戻らなくなったり、元の名前を間違えて保存してしまった場合は、一番下の **「メンテナンス / 強制操作」** エリアを使用してください。
- **この名前に強制変更**: 入力した名前に強制的に書き換え、それを「初期の名前」として保存します。
- **現在の名前を初期の名前として取得**: 今 Chatwork で表示されている名前を「初期の名前」として読み込み直します。

---

## 注意事項
- **Chatworkタブ**: APIの実行にはChatworkのタブが開いている必要があります。タブがない場合は「Chatworkを開く」ボタンが表示されます。
- **メンテナンス機能**: 戻し忘れや名前の不一致が発生した場合、設定画面下部の「メンテナンス」エリアから、名前の強制変更や初期名の再設定が可能です。
- **アイコン**: 以下の画像ファイルを用意して配置してください：
  - `icon16.png`, `icon48.png`, `icon128.png`

## 使用する内部API
- エンドポイント: `https://www.chatwork.com/gateway/send_profile_setting.php`
- メソッド: POST
- 認証: ログイン中のセッションとCSRFトークンを使用
